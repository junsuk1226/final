<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kdt.finalproject.mapper.ReviewMapper">

<select id="getReview" resultType="com.kdt.finalproject.vo.ReviewVO">
  	SELECT * FROM final.reivew
</select>

<select id="getReviewLog" parameterType="String" resultType="com.kdt.finalproject.vo.ReviewLogVO">
  	SELECT * FROM final.reviewlog
    WHERE r_idx = #{r_idx}
</select>

<!--리뷰 작성-->
<insert id="addReview" parameterType="com.kdt.finalproject.vo.ReviewVO">
    INSERT INTO final.review(m_idx, r_content, r_score, restCd, r_status)
    VALUES (#{m_idx}, #{r_content}, #{r_score}, #{restCd}, #{r_status})
</insert>

<!--리뷰 로그 작성-->
<insert id="addReviewLog" parameterType="com.kdt.finalproject.vo.ReviewLogVO">
    INSERT INTO final.reviewlog(m_idx, rl_writeDate, r_idx)
    VALUES (#{m_idx}, NOW(), #{r_idx})
</insert>

<!-- 리뷰 목록 가져오기 -->
<select id="getReviewList" parameterType="String" resultType="com.kdt.finalproject.vo.ReviewVO">
  	SELECT * FROM final.review
    WHERE m_idx = #{m_idx} and r_status = 0
</select>

  <!-- 리뷰 삭제 -->
  <update id="reviewdel" parameterType="Map">
  	UPDATE final.review
  	SET r_status = 1
  	WHERE r_idx = #{r_idx} AND m_idx=${m_idx}
  </update>

<!-- 원들들을 가져오는 SELECT 
  <select id="bbsList" resultMap="map1" parameterType="Map">
  	SELECT * FROM(
		SELECT @RN:=@RN+1 AS rnum,a.* FROM(
			SELECT * FROM mini2_bbs
			WHERE b_status = 0
			ORDER BY b_idx DESC
		) a, (SELECT @RN:=0) b
	) c WHERE c.rnum BETWEEN #{begin} AND #{end}
  </select>
  -->

</mapper>